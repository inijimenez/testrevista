"use strict";!function(e){function t(){this.pageLength=0,this.stringSize=50,this.stringPrefix="...",this.stringSuffix="...",this.xmlUrl="",this.currentSearch=""}var a={},r={};t.prototype.loadXml=function(e){if(!a[e]){a[e]=[];var t=this.xmlUrl.replace("%num%",e),r=new XMLHttpRequest;r.open("GET",t,!0),r.onreadystatechange=function(){4===r.readyState&&self.postMessage({method:"parse",data:r.responseText,page:e})},r.send()}},t.prototype.normalize=function(e){for(var t=["ßàáâãäåæçèéêëìíîïðñòóôõöøšùúûüýýþÿž","saaaaaaaceeeeiiiidnoooooosuuuuyybyz"],a={},r=0,s=t[0].length;r<s;r++)a[t[0][r]]=new RegExp(t[0][r],"g");return function(e){if("string"!=typeof e)return e;e=e.toLowerCase();for(var r=0,s=t[0].length;r<s;r++)e=e.replace(a[t[0][r]],t[1][r]);return e.replace(/[^\w\u4E00-\uFA29]/g,"-")}}(),t.prototype.parseJson=function(e,t){if(0===e)for(var s=t.texts.page,n=s.keyValue?[s]:s,i=0;i<n.length;i++){r[n[i]["@num"]]=n[i]["@label"]||n[i]["@l"],a[n[i]["@num"]]=[];var o=n[i].block;if("undefined"!=typeof o)if(o instanceof Array)for(var h=0;h<o.length;h++)a[n[i]["@num"]].push(o[h].keyValue);else a[n[i]["@num"]].push(o.keyValue);else n[i].keyValue&&a[n[i]["@num"]].push(n[i].keyValue);a[n[i]["@num"]]=a[n[i]["@num"]].join(" — ").replace(/\s+—[\s—]+/gim," — ")}else{var p=t.page.block;a[e]=[];for(var f=0;f<p.length;f++)a[e].push(p[f].keyValue);a[e]=a[e].join(" — ").replace(/\s+—[\s—]+/," — ")}},t.prototype.prepareCache=function(){if(this.xmlUrl.indexOf("%num%")!==-1)for(var e=1;e<this.pageLength;e++)this.loadXml(e);else this.loadXml(0)},t.prototype.setPageLength=function(e){this.pageLength=e},t.prototype.setXmlUrl=function(e){this.xmlUrl=e},t.prototype.setPrefix=function(e){"undefined"!=typeof e&&(this.stringPrefix=e)},t.prototype.setWordSearch=function(e){"undefined"!=typeof e&&(this.wordSearch=e)},t.prototype.setSuffix=function(e){"undefined"!=typeof e&&(this.stringSuffix=e)},t.prototype.setStringSize=function(e){"undefined"!=typeof e&&(this.stringSize=e)},t.prototype.getSearchMessage=function(e,t,a,s){function n(e,t){return e.indexOf(t)>-1&&(i=e.indexOf(t),!0)}var i,o,h=this.normalize(t),p=this.normalize(e);if(s?(i=h.indexOf(p),o=i!==-1):o=p.split("-").every(n.bind(this,h)),o){var f=Math.min(t.length+p.length,i+p.length+this.stringSize),g=Math.max(i-this.stringSize,0),l=t.substring(g,f);if(g>0&&(l=this.stringPrefix+l),f<t.length&&(l+=this.stringSuffix),l=s?l.replace(new RegExp("("+p+"|"+e+")","igm"),"<b>$1</b>"):l.replace(new RegExp("("+p.split("-").join("[^a-zA-Z0-9]")+"|"+p.replace(/-/gim,"|")+"|"+e.replace(/-/gim,"|")+")","igm"),"<b>$1</b>"),this.normalize(this.currentSearch)===p){var u={method:"result",page:a,string:l,isStrict:s};return r[a]&&(u.label=r[a]),u}}},t.prototype.start=function(e){this.currentSearch=e;for(var t=Object.keys(a),r=0;r<t.length;r++){var s=t[r],n=this.getSearchMessage(e,a[s],s,!0);n&&self.postMessage(n);var i=this.getSearchMessage(e,a[s],s,!1);!i||n&&i.page===n.page||self.postMessage(i)}self.postMessage({method:"end"})},e.Search=t}(self);var search=new Search;self.addEventListener("message",function(e){"config"===e.data.method?(search.setPageLength(e.data.pageLength),search.setXmlUrl(e.data.xmlUrl),search.setPrefix(e.data.prefix),search.setSuffix(e.data.suffix),search.setStringSize(e.data.stringSize),search.setWordSearch(e.data.wordSearch),search.prepareCache()):"search"===e.data.method?search.start(e.data.search):"parsedString"===e.data.method&&search.parseJson(e.data.page,e.data.data)},!1);